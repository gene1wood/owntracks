<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="OwnTracks.org">
  <link rel="canonical" href="http://owntracks.org/features/tls/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>TLS - OwnTracks Booklet</title>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "TLS";
    var mkdocs_page_input_path = "features/tls.md";
    var mkdocs_page_url = "/features/tls/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OwnTracks Booklet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Intro</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/whathow/">What it does</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/clients/">Clients</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/scenarios/">Scenarios</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/apps/">Apps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/topics/">Topics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/broker/">Broker</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/bridge/">Bridging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/waypoints/">Waypoints</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../guide/beacons/">Beacons</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Features</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../comparison/">Comparison</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ios/">iOS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../android/">Android</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">TLS</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tlscert/">TLS client</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../location/">Location</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tid/">Tracker ID</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../friends/">Friends</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../card/">Card</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../poi/">POI</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tours/">Tours</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../waypoints/">Waypoints</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../beacons/">Beacons</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pedometer/">Pedometer</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../featured/">Featured</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../encrypt/">Encryption</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../remoteconfig/">Remoteconfig</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../debug/">Debugging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../traccar/">Traccar</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../tech/json/">JSON</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tech/http/">HTTP</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tech/mqtt/">MQTT</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tech/qr/">URIs and QR codes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tech/program/">Code</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Sundry</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../terminology/">Terminology</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../clients/recorder/">Docker</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../privacy/">Privacy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../people/">People</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ideas/">Ideas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../faq/">Answers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../press/">Press</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OwnTracks Booklet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Features &raquo;</li>
        
      
    
    <li>TLS</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/owntracks/booklet/edit/master/docs/features/tls.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h2 id="tls">TLS</h2>
<p>You want data between your mobile device (a.k.a. smartphone) and the MQTT broker you use to be secured from eavesdropping. This is accomplished using <em>TLS</em>. When you configure your broker you will generate what is called a CA certificate which is basically a large amount of bits. (See below for the nitty gritty.)</p>
<p>Configuring TLS (<a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security</a>) for OwnTracks involves doing three things:</p>
<ul>
<li>Obtain a TLS certificate/key pair (see below on how to do this) if you don't yet have one</li>
<li>Configure TLS on the MQTT broker</li>
<li>Configuring the app to use TLS</li>
</ul>
<p>You can share the certificate if you want to (though not many people will want it ...)
It's so public, that it's perfectly OK to send yourself the file by, say, e-mail.</p>
<h2 id="configure-tls-on-the-mosquitto-broker">Configure TLS on the Mosquitto broker</h2>
<p>We'll first show you how to set up TLS on your Mosquitto <a href="../../guide/broker/">broker</a>.
The basic configuration for TLS in <a href="http://mosquitto.org/man/mosquitto-conf-5.html">mosquitto.conf</a> is:</p>
<pre><code>listener 8883
cafile .............
certfile .............
keyfile .............
</code></pre>
<p>(see also: <a href="http://mosquitto.org/man/mosquitto-tls-7.html">mosquitto-tls</a>.)</p>
<ul>
<li><code>8883</code> is the standard MQTT port for TLS connections. Change it if you need to, but make sure your OwnTracks app is configured to use the same port.</li>
<li><code>cafile</code> is the path to the certificate authority file</li>
<li><code>certfile</code> points to your server's certificate in PEM format</li>
<li><code>keyfile</code> points to your server's secret key file (which you <em>never</em> divulge!)</li>
</ul>
<h2 id="configure-the-owntracks-app-to-use-tls">Configure the OwnTracks app to use TLS</h2>
<p>We show you here how to set up your iOS or Android device with that kind of certificate.</p>
<p>In both cases we assume you've got an e-mail in your inbox with the file you've sent yourself. This file has a <code>.crt</code> extension, and in both Android and iOS you can simply launch configuration by clicking on the attachment.</p>
<p>In our example, the CA certificate is called <code>MQTTitude-ca.crt</code>.</p>
<h3 id="android">Android</h3>
<p>Note that by following these instructions on Android you'll be prompted to set a device PIN or pattern to protect the device. If you already have that, just carry on. If you absolutely don't want to do that, you should download the certificate into, say, the Downloads folder, and configure it manually in OwnTracks (see below).</p>
<p>So, here's your e-mail message with said attachment.</p>
<p><img alt="Android" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-cert-01-mail.png" /></p>
<p>Now click on the attached file, and you'll get the following dialog where you have to specify a name for the certificate (sigh: the certificate contains a name, but Android wants you to name it anyway). Give it any old name. We've chosen <code>MQTTitude</code>, of course. Then click OK.</p>
<p><img alt="Android" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-cert-02-stor.png" /></p>
<p>That's it. You're done, and if you no longer require the certificate file just delete the e-mail, though we recommend you keep it around for a bit.</p>
<p>Note that installing a certificate into Android will, since Kitkat (4.4) bring up a warning when you power up your device. This warning is harmless (even though we consider it quite annoying).</p>
<p><img alt="Android" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/cert-alert.png" /></p>
<h3 id="ios">iOS</h3>
<p>So, here's your e-mail containing the certificate file. Click on it to launch the profile installer. No worries: we're not going to break anything. We're just adding yet another certificate to iOS' certificate store, and you're going to say that you trust that certificate. You ought to trust it: you've just created it yourself!</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-01-mail.png" /></p>
<p>You've clicked, and here's the trust store. You see the certificate has a name, but it's not trusted yet. Click on Install.</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-02-stor.png" /></p>
<p>Read the text if you must. Just kidding: honestly, it's ok. But do read the text, and then click "Install" on the top right.</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-03-stor.png" /></p>
<p>There you go! That's it: the certificate was installed.</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-04-stor.png" /></p>
<p>You're done, and if you no longer require the certificate file just delete the e-mail, though we recommend you keep it around for a bit.</p>
<h3 id="manual-configuration-on-android">manual configuration on Android</h3>
<p>From the, say, e-mail you got with the certificate, click "save" on the attached <code>.crt</code> file which is stored on your device's <code>Download</code> folder.</p>
<p>In OwnTracks's settings, select <code>TLS (Custom Certificate)</code></p>
<p><img alt="Android custom" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-custom-01.png" /></p>
<p>Now comes the hard part: you have to enter the path to the certificate you downloaded. On my device this is <code>/storage/emulated/0/Download/MQTTitude.crt</code>. Your mileage, etc; </p>
<p><img alt="Android custom" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-custom-02.png" /></p>
<p>When you click <code>Connect</code>, it will try and use your certificate. Good luck! ;-)</p>
<h2 id="the-nitty-gritty">The nitty gritty</h2>
<p>That CA certificate file we mentioned? The attachment called <code>something.crt</code>?
It looks like this, in fact, in what is called <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM</a> format; but you don't really want to know that, but if you do, this is what it looks like:</p>
<pre><code>-----BEGIN CERTIFICATE-----
MIIDGTCCAoKgAwIBAgIJAODXne2yV51zMA0GCSqGSIb3DQEBBQUAMGcxCzAJBgNV
BAYTAkRFMQwwCgYDVQQIEwNOUlcxETAPBgNVBAcTCElyZ2VuZHdvMRYwFAYDVQQK
...
pjGM/XgBs62UhqXnoHrHh/AHIiHieuNFwOhUg0fD/vQ5O6UZkJTWY5LLmEyPN5sS
cPZ5pT/WCvGuIOgNdy1VyWJrrlAjeQlbK+GDcNc=
-----END CERTIFICATE-----
</code></pre>
<p>That's plain text, even though it might be hard to believe. Actually, it's all sorts of magic wrapped into ASCII bytes, but we can look inside that, and we'll give you a sneak peak:</p>
<pre><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            e0:d7:9d:ed:b2:57:9d:73
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=DE, ST=NRW, L=Irgendwo, O=MQTTitude.org/emailAddress=jjolie@example.com
        Validity
            Not Before: Aug 18 10:26:08 2013 GMT
            Not After : Aug 16 10:26:08 2023 GMT
        Subject: C=DE, ST=NRW, L=Irgendwo, O=MQTTitude.org/emailAddress=jjolie@example.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
            RSA Public Key: (1024 bit)
                Modulus (1024 bit):
                    00:bd:70:b0:49:d4:17:c9:17:33:4d:74:fc:61:25:
                    ...
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                4C:89:83:F0:33:AD:2B:D7:FD:DE:1D:6D:8D:00:52:C1:1C:75:B1:85
            X509v3 Authority Key Identifier: 
                keyid:4C:89:83:F0:33:AD:2B:D7:FD:DE:1D:6D:8D:00:52:C1:1C:75:B1:85
                DirName:/C=DE/ST=NRW/L=Irgendwo/O=MQTTitude.org/emailAddress=jjolie@example.com
                serial:E0:D7:9D:ED:B2:57:9D:73

            X509v3 Basic Constraints: 
                CA:TRUE
    Signature Algorithm: sha1WithRSAEncryption
        74:12:f8:d0:51:3a:c6:f8:62:75:61:d1:56:2f:bf:e3:64:3c:
        ...
</code></pre>
<p>Better, huh? Well, at least parts of it are now readable. Hope you liked this.</p>
<h3 id="obtain-a-certificate-and-key">Obtain a certificate and key</h3>
<p>The following sections are not an endorsement of a particular Certification Authority, but rather are a few tips on getting you set up with <a href="http://mosquitto.org">Mosquitto</a>.</p>
<p>You can also create your own self-signed certificate. We provide the <a href="https://github.com/owntracks/tools/tree/master/TLS">generate-CA.sh</a> utility for doing this easily.</p>
<h4 id="startsslcom">startssl.com</h4>
<p>If you have a key-pair issued by <em>startssl.com</em>, you'll be issued a key (in a <code>*.key</code> file), and a certificate (as <code>*.pem</code> or <code>*.crt</code> -- either contains a PEM-encoded certificate).</p>
<p><a href="http://mosquitto.org">Mosquitto</a> will need the certificate chain for <em>startssl.com</em>, which you can find as <a href="http://www.startssl.com/certs/ca-bundle.crt">ca-bundle.crt</a> at <a href="http://www.startssl.com/certs/">www.startssl.com/certs/</a>.</p>
<p>As far as TLS is concerned, you'll therefore set up your <code>mosquitto.conf</code> as follows, specifying corrrect paths to the files.</p>
<pre><code>listener 8883
cafile ca-bundle.crt
certfile server.crt
keyfile server.key
</code></pre>
<p>Then download the <em>startssl.com</em> CA certificate (<a href="http://www.startssl.com/certs/ca.crt">ca.crt</a>) and install that on your device as described above.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tlscert/" class="btn btn-neutral float-right" title="TLS client">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../security/" class="btn btn-neutral" title="Security"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/owntracks/booklet/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../security/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tlscert/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
