<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Docker - OwnTracks Booklet</title>
  

  <link rel="shortcut icon" href="../../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/custom.css" rel="stylesheet">

  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OwnTracks Booklet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Intro</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/whathow/">What it does</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/clients/">Clients</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/scenarios/">Scenarios</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/apps/">Apps</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/topics/">Topics</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/broker/">Broker</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/bridge/">Bridging</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/waypoints/">Waypoints</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../guide/beacons/">Beacons</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Features</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/comparison/">Comparison</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/ios/">iOS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/android/">Android</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/security/">Security</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/tls/">TLS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/tlscert/">TLS client</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/location/">Location</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/tid/">Tracker ID</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/friends/">Friends</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/card/">Card</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/waypoints/">Waypoints</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/beacons/">Beacons</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/pedometer/">Pedometer</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/featured/">Featured</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/encrypt/">Encryption</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/remoteconfig/">Remoteconfig</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/debug/">Debugging</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/traccar/">Traccar</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>API</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/json/">JSON</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/http/">HTTP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/mqtt/">MQTT</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/qr/">QR</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/program/">Code</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Sundry</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../terminology/">Terminology</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Docker</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#recorder">Recorder</a></li>
                
                    <li><a class="toctree-l4" href="#docker">Docker</a></li>
                
                    <li><a class="toctree-l4" href="#synology">Synology</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../privacy/">Privacy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../people/">People</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ideas/">Ideas</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../faq/">Answers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../press/">Press</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OwnTracks Booklet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Sundry &raquo;</li>
        
      
    
    <li>Docker</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/owntracks" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="recorder">Recorder</h2>
<p>The <a href="https://github.com/owntracks/recorder">OwnTracks Recorder</a> is a lightweight program for storing and accessing location data published via MQTT by the OwnTracks apps. It is a compiled program which is easily to install and operate even on low-end hardware, and it doesn't require an external database.</p>
<h3 id="docker">Docker</h3>
<p>We have an <a href="https://hub.docker.com/r/owntracks/recorderd/">experimental Docker image</a> which you can use to launch the Recorder and its associated <a href="http://mosquitto.org">Mosquitto</a> broker. The image expects a volume which you mount into it into which it will write persistent data. Furthermore, you pass environment variables into the container at first launch with which TLS certificates are created with subject (and subjAltNames) according to your preference. </p>
<p><img alt="architecture" src="../owntracks-docker-host.png" /></p>
<p>As an example, let's assume the host on which the Docker container will run has two IP addresses, <code>192.168.1.82</code> and <code>10.0.1.83</code>. We will also assume that you want the MQTT port on the host to be <code>11883</code> and its TLS port to be <code>18883</code>. Let's further assume that one of these addresses is DNS accessible as <code>ds415.ww.mens.de</code> and the other as <code>mqtt.ww.mens.de</code>. We want the TLS certificates for the container's Mosquitto broke to contain subjAltNames for these, so we will proceed as follows:</p>
<ol>
<li>Create a directory which will be mounted into the container for persistent data: <code>mkdir /var/owntracks</code>, say.</li>
<li>Launch the Docker container with a script such as this one</li>
</ol>
<pre><code class="sh">#!/bin/sh

docker run -v /var/owntracks:/owntracks -p 11883:1883 -p 18883:8883 -p 8083:8083 \
    --name owntracks-recorder \
    --hostname ds415.ww.mens.de \
    -e MQTTHOSTNAME=&quot;ds415.ww.mens.de&quot; \
    -e IPLIST=&quot;192.168.1.1 192.168.1.82&quot; \
    -e HOSTLIST=&quot;mqtt.ww.mens.de ds415.ww.mens.de&quot; \
    owntracks/recorderd
</code></pre>

<p>That should download the Docker image (if necessary) and launch a container accordingly. At first run, the TLS certificates are created in the <code>/owntracks</code> volume (which was mounted onto <code>/var/owntracks</code> on the host). The host's directory will also contain a <code>mosquitto/</code> directory which Mosquitto's configuration file, and the Recorder will use <code>/owntracks/recorder/</code> as its persistent storage.</p>
<p>The above script will surface the port numbers as follows:</p>
<ul>
<li>MQTT will be on 11883</li>
<li>MQTT over TLS on 18883</li>
<li>and the Recorder's Web interface on 8083</li>
</ul>
<p>You can assign these as you wish. Recall, that if you use our example, your OwnTracks apps will also have to access 18883 over TLS (instead of the default 8883 over TLS).</p>
<p>You may want to modify the default ACLs under <code>owntracks/mosquitto/mosquitto.acl</code>. For more please check <a href="https://owntracks.org/booklet/guide/broker/#acls">Broker Configurations</a>.</p>
<h4 id="exploring">Exploring</h4>
<p>If you want to see what's going on within the container, try launching an MQTT subscriber: first obtain the container's ID:</p>
<pre><code class="sh">docker ps
CONTAINER ID        IMAGE                   ...
5c8800a4ab78        owntracks/recorderd     ...
</code></pre>

<p>Then, say, point <code>mosquitto_sub</code> to the broker from within the container:</p>
<pre><code class="sh">docker exec -ti 5c8800a4ab78  mosquitto_sub -d -v -t '#'
</code></pre>

<h3 id="synology">Synology</h3>
<p>A number of Synology devices with newer DSM support Docker; please refer to the original documentation to determine if yours has Docker support. If it does, <a href="http://blog.pavelsklenar.com/how-to-install-and-use-docker-on-synology/">this page</a> describes how to use Docker. Once you've installed the package, you can proceed to download the Recorder image (search for <code>owntracks-recorder</code>; the image you want is called <code>owntracks-recorderd</code> with a trailing <code>d</code> on it) and launch a container. (This was tested on DSM 5.2.)</p>
<p>Launch container creation with the wizard, and give the container a name, e.g. <code>owntracks-recorder</code>.</p>
<p><img alt="" src="../jmbp-2264.png" /></p>
<p>Leave the settings in Step 2 as they are.</p>
<p><img alt="" src="../jmbp-2266.png" /></p>
<p>Add the TCP ports for MQTT (plain), MQTT (over TLS), and the Recorder's HTTP interface.</p>
<p><img alt="" src="../jmbp-2273.png" /></p>
<p>In the <em>Volume</em> tab, add a host folder which will be mounted into the container. Here we've chosen <code>/home/jpm/owntracks</code> which we first created with DSM's file manager.</p>
<p><img alt="" src="../jmbp-2274.png" /></p>
<p>In the <em>Environment</em> tab add the variables which will be exported into the container. Note that <code>IPLIST</code> and <code>HOSTLIST</code> (both of which are optional) take a space-separated list of values.</p>
<p><img alt="" src="../jmbp-2275.png" /></p>
<p>Check everything and press <em>Apply</em> to have the container created.</p>
<p><img alt="" src="../jmbp-2276.png" /></p>
<p>The container can then be launched by pressing the "on" switch.</p>
<p><img alt="" src="../jmbp-2277.png" /></p>
<p>The Docker container log will show console output.</p>
<p><img alt="" src="../jmbp-2278.png" /></p>
<p>The Recorder running on the Synology DiskStation will be accessible via the host port numbers you configured (see above for more information).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../privacy/" class="btn btn-neutral float-right" title="Privacy"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../terminology/" class="btn btn-neutral" title="Terminology"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../terminology/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../privacy/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
